language: cpp
dist: xenial
compiler: gcc

branches:
  except:
    - /^appveyor.*$/

git:
  depth: 10

env:
  global:
    - CMAKE_OPTIONS="-DCMAKE_CXX_FLAGS=-Wno-implicit-fallthrough"
    # The next declaration is the encrypted COVERITY_SCAN_TOKEN, created
    #   via the "travis encrypt" command using the project repo's public key
    - secure: "He9tPPcvQVnFQM1nwbS2s0XpUisoVmBPqQ8shiuSi8rEfae+0Y+r3p8eCJanhonSTGoD6Phmo1M9UlTEFySUJrAI3pv366WK8tEBkr8EooxMp1drSiOli6wUEwJabRGRff40E2A0TXfD6NkW6TJMnMk5LqMWA+uAaf45TQKMsSCZSOkox2wvJAVc/JGgMzkA2G74niFZrUS/rqkkYpup8V96xnPrF0uD1Ji+cyWT0aVAhzc08zYWvLSvf3iyFqetg1x+H297w9h2Dh60AWMMlPrGJqV9jJwdRppS6ZDkRajXrLDkyN6jpcBqB2YGHRbED4CZp6WTVCtD+dKTMT3WuYpJi3i5/faHYC6ierv1+8mthyV9ZVV0/0QEHbW69CBF+oy8mJ+Erxdl3ta0x9wN0Jfa6u5aGHDpYZm9GbbykVDOJAA0rkdOI5xwwzxIfDOV+kbbOE1QtF3S0rqksagwJSHDY+YgKEhUdDSXbdcnd/IyW0QFClZ4d6Jv5duRVB1SahJbmYt6uBoSZX2DfbPvP9ijJ9VAB9m2b+6CManFVJ4X00k73bWpYayLhEnadTwrreWyi6QZEW0UNVEcnm5cnb+GjH60yzQjGl8cbGVAYjlqhGU5YdUDoO1K+wRNFpemG3W6WLKKI804e1tymGjIvLUW/GL0eadLnnjxNqOQEPE="

before_install:
  - echo -n | openssl s_client -connect "scan.coverity.com:443" | sed -ne '/-BEGIN CERTIFICATE-/,/-END CERTIFICATE-/p' | sudo tee -a /etc/ssl/certs/ca-

addons:
  coverity_scan:
    project:
      name: "mmaulwurff/gzdoom"
      description: "<Your project description here>"
    notification_email: mmaulwurff@gmail.com
    build_command_prepend: "./coverity_pre_build.sh"
    build_command: "./coverity_build.sh"
    branch_pattern: coverity_scan
  apt:
    sources:
      - ubuntu-toolchain-r-test
    packages:
      - libsdl2-dev

script:
  - ./coverity_pre_build.sh
  - ./coverity_build.sh

notifications:
  email: false
